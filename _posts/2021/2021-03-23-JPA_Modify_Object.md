---
layout: post
title: -Spring- JPA 데이터 수정 (Modify Data)
categories: [Development,Spring]
tags: [Spring]
date: 2021-03-23 16:42:00 +0900
excerpt_separator: <!--more-->
hide: false
---
JPA에서 객체의 값을 수정하는 법을 알아보자
<!--more-->

## Modify Object  

 JPA는 값을 수정하는 방법이 두가지가 있다.  

### 준영속 엔티티  

먼저, 준영속 엔티티를 이해해야 한다. 준영속 엔티티란 무엇인가?  
준영속 엔티티란 영속성 컨텍스트가 더이상 관리하지 않는 엔티티를 말한다.
DB에 한번 저장되어서 식별자가 존재한다. 이렇게 임의로 만들어넨 엔티티도 기존 식별자를 가지고 있으면 준영속 엔티티로 볼 수 있다. 준영속 엔티티는 위에서 말한대로 영속성 컨텍스트가 더이상 관리하지않기 때문에 값을 변경해도 적용되지 않는다.  

### 병합 (merge)  

병합은 준영속상태의 엔티티를 영속상태로 변경할 때 사용한다. `merge` method는  파라미터로 넘어온 준영속 엔티티의 실별자 값으로 1차 캐시에서 엔티티를 조회한다.  만약 1차캐시에 엔티티가 존재하지 않는다면, 데이터베이스에서 엔티티를 조회한다. 조회한 영속 엔티티에 `merge`에서 파라미터로 넘어온 값을 채워 넣는다. 그후 영속상태인 객체를 반환한다. 말로만 보면 수정이 되네 ! 하겠지만 기존에 널값을 가지고있던 아니던 그냥 `overwrite`해버린다고 할 수 있다.  

### 변경감지  

준영속 엔티티는 영속성 컨텍스트가 관리하지않는다. 즉이말은 영속성 컨텍스트로 관리해주면 된단 뜻이다. 값변경이 필요한 엔티티의 식별자로 객체를 찾아와 엔티티를 만들어 영속성을 부여하고 해당 영속성이 부여된 객체의 값을 변경한다면 Transaction commit 시점에 영속성 컨텍스트가 값을 비교하여 데이터베이스에 `UPDATE`쿼리를 날린다.  

간단하게 요약하면,
1. merge()를  
2. 사용하지  
3. 말자.
